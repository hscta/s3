<!DOCTYPE html>

<style>

    md-toolbar {
        min-height: 20px;
    }

    .map-dialog {
        padding: 0 !important
    }

    .map-dialog-content {
        overflow: hidden;
    }

    .input-fields {
        margin-top: -24px;
    }

    .error-msg {
        color: #f00;
        font-size: 10px;
        min-height: 20px;
    }

    md-toolbar.md-default-theme:not(.md-menu-toolbar), md-toolbar:not(.md-menu-toolbar) {
        background: #d1e934;
    }

    .play-pause-btns {
        background: #d1e934 !important;
    }

    .container-margin{margin-bottom: 0; padding:0; height:31px}

    /*.md-dialog-container {*/
    /*display: flex;*/
    /*justify-content: center;*/
    /*align-items: center;*/
    /*position: absolute;*/
    /*left: 0;*/
    /*top: 0;*/
    /*right: 0;*/
    /*bottom: 0;*/
    /*z-index: $z-index-dialog;*/
    /*}*/

    /*.md-dialog-container{height:100%;}*/
    /*md-dialog{max-width:100%;}*/

    .btn {
        background-color: #d1e934;
        border: none;
        color: white;
        padding: 18px 12px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        /* border-radius: 100%; */
        width: 10px;
        box-shadow: 1px 1px 8px 0px #FFF;
        height: 10px;
    }

    .btn-img {
        background: url('assets/images/play.png') no-repeat;
        width: 13px;
    }

    .btn:hover {
        cursor: pointer;
    }

    .history-dialog .angular-google-map-container {
        height: 554px;
    }

     .md-button{
         margin:6px 1px;
     }

    .md-button.md-fab.md-mini{
        line-height:37px;
        width:34px;
        height:36px;
    }

    .icon-font {
        font-size: 19px;
    }

</style>

<script type="text/ng-template" id="historyInfoWindow.html">
    <div style="width:230px; height:62px; max-width:230px; min-width:230px; overflow:hidden; padding-top:5px;">
        <table>
            <tr>
                <td><strong>Date</strong></td>
                <td>{{parameter.data.gpstime | date : 'dd MMM yyyy - h:mm:ss a'}}</td>
            </tr>
            <tr>
                <td style="padding-right:5px;"><strong>Odometer</strong></td>
                <td>{{parameter.data.odometer}} km</td>
            </tr>
            <tr>
                <td><strong>Speed</strong></td>
                <td>{{parameter.data.speed}} kmph</td>
            </tr>
        </table>
    </div>
</script>

<md-dialog aria-label="Location Tracker History" ng-cloak flex="85">
    <md-toolbar style="height:42px; text-align:center;">
        <div class="md-toolbar-tools md-accent">
            <h2 layout-align="center center" style="width:100%" ng-click="another()">Location History</h2>
            <span flex></span>
            <md-button class="md-icon-button" ng-click="cancel()">
                <md-icon md-font-library="material-icons">close</md-icon>
            </md-button>
        </div>
    </md-toolbar>
    <md-content     >
        <md-tabs class="" md-selected="getSelectedTab()" md-align-tabs="top" md-border-bottom md-autoselect md-dynamic-height>

            <md-tab>
                <md-tab-label>
                    History
                    <md-tooltip md-direction="bottom">Vehicle History</md-tooltip>
                </md-tab-label>

                <md-tab-body>

                    <span class="error-msg">{{errorMsg}}</span><br/>

                    <div layout="row" layout-align="space-around center">
                        <div layout="row" class="input-fields" layout-align="space-around center" flex>
                            <md-input-container class="container-margin">
                                <label>Vehicle No</label>
                                <input type="text" ng-model="vehicleNumber" readonly>
                            </md-input-container>

                            <md-input-container class="container-margin">
                                <label>Start Time</label>
                                <input type="text" id="start_time" ng-model="startTime">
                            </md-input-container>

                            <md-input-container class="container-margin">
                                <label>End Time</label>
                                <input type="text" id="end_time" ng-model="endTime">
                            </md-input-container>
                            <md-button class="md-accent" ng-click="getHistory()">Get History</md-button>
                        </div>
                        <div layout="row" layout-align="end start">
                        </div>
                    </div>

                    <md-dialog-content class="map-dialog-content">
                        <div class="md-dialog-content map-dialog history-dialog">
                            <ui-gmap-google-map center='historyMap.center' zoom='historyMap.zoom' draggable="true"
                                                options="historyMap.mapOptions" bounds="historyMap.bounds"
                                                control="historyMap.mapControl">

                                <ui-gmap-map-control
                                    template="app/components/landingpage/dashboard/map/history-map-control.html"
                                    controller="InnerMapController"
                                    position="top-right"></ui-gmap-map-control>

                                </ui-gmap-map-control>

                                <ui-gmap-marker
                                    idkey="'self'"
                                    coords="clickedMarker"
                                    click="clickedMarker.click"
                                    options="clickedMarker.options"
                                    events="clickedMarker.events"
                                    control="clickedMarker.control">
                                </ui-gmap-marker>

                                <ui-gmap-polyline
                                    path="trace.path"
                                    stroke="trace.stroke"
                                    clickable="trace.clickable"
                                    geodesic="trace.geodesic"
                                    visible="trace.visible"
                                    fit="trace.fit"
                                    static="trace.static"
                                    events="trace.events"
                                    icons="trace.icons">
                                </ui-gmap-polyline>

                                <ui-gmap-window show="historyInfoWindow.show" coords="historyInfoWindow.coords"
                                                control="historyInfoWindow.control"
                                                options="historyInfoWindow.options" closeClick="historyInfoWindowClose()"
                                                templateUrl="'historyInfoWindow.html'"
                                                templateParameter="historyInfoWindow"
                                                isIconVisibleOnClick="true">
                                </ui-gmap-window>

                            </ui-gmap-google-map>
                        </div>
                </md-tab-body>
            </md-tab>

            <md-tab  >
                <md-tab-label>
                    Geofence
                    <md-tooltip md-direction="bottom">Geofence </md-tooltip>
                </md-tab-label>

                <md-tab-body >
                    <div class="geofence-cont" ng-controller="GeofenceController as vm">
                        <div class="geo-leftbar" ng-click="vm.vehicleFilterVar = false">
                            <div class="geo-rep-item-head">Reports</div>
                            <div class="geo-rep-item" ng-class="{'active':vm.currRep.id == rep.id}" ng-repeat="rep in vm.reports" ng-click="vm.setReport(rep)">{{rep.name}}</div>
                        </div>
                        <div class="geo-cont" >
                            <div class="geoc-head">

                                <span class="error-msg">{{errorMsg}}</span><br/>

                                <div layout="row" layout-align="space-around center">
                                    <div layout="row" class="input-fields" layout-align="space-around center" flex>
                                        <md-input-container class="container-margin">
                                            <label>Fences</label>
                                            <md-select ng-model="vm.currFence">
                                                <md-option ng-value="opt" ng-repeat="opt in vm.currRep.fences">{{ opt.name }}</md-option>
                                            </md-select>
                                        </md-input-container>
                                        <div class="geo-mul-back" ng-if="vm.vehicleFilterVar" ng-click="vm.vehicleFilterVar = false"></div>
                                        <md-input-container class="container-margin geo-multiSel">
                                            <label>Vehicle Name</label>
                                            <input type="text" ng-focus="vm.vehicleFilterVar = true" ng-model="vm.vehicleFilter">
                                            <div class="geo-ms-cont" ng-if="vm.vehicleFilterVar">
                                                <md-list>
                                                    <md-list-item class="md-2-line" ng-repeat="item in vm.currFence.vehicles | filter : vm.vehicleFilter">
                                                        <md-checkbox ng-model="item.done"></md-checkbox>
                                                        <div class="md-list-item-text">
                                                            <h3>{{item.name}}</h3>
                                                        </div>
                                                    </md-list-item>
                                                </md-list>
                                            </div>
                                        </md-input-container>

                                        <md-input-container class="container-margin">
                                            <label>Start Time</label>
                                            <input type="text" id="start_time" ng-model="startTime">
                                        </md-input-container>

                                        <md-input-container class="container-margin">
                                            <label>End Time</label>
                                            <input type="text" id="end_time" ng-model="endTime">
                                        </md-input-container>
                                        <md-button class="md-accent">Get Report</md-button>
                                     </div>
                                    <div layout="row" layout-align="end start">
                                    </div>
                                </div>
                            </div>
                            <div class="geoc-body">
                                <table class="geo-table">
                                    <tr>
                                        <th ng-click="vm.setSort(1,'name')">
                                            Vehicle Number
                                            <i ng-if="vm.tableSort.reverse && vm.tableSort.id == 1" class="fa fa-chevron-up"></i>
                                            <i ng-if="!vm.tableSort.reverse && vm.tableSort.id == 1" class="fa fa-chevron-down"></i>
                                        </th>
                                        <th ng-click="vm.setSort(2,'event')">
                                            Event
                                            <i ng-if="vm.tableSort.reverse && vm.tableSort.id == 2" class="fa fa-chevron-up"></i>
                                            <i ng-if="!vm.tableSort.reverse && vm.tableSort.id == 2" class="fa fa-chevron-down"></i>
                                        </th>
                                        <th ng-click="vm.setSort(3,'time')">
                                            Time
                                            <i ng-if="vm.tableSort.reverse && vm.tableSort.id == 3" class="fa fa-chevron-up"></i>
                                            <i ng-if="!vm.tableSort.reverse && vm.tableSort.id == 3" class="fa fa-chevron-down"></i>
                                        </th>
                                        <th ng-click="vm.setSort(4,'location')">
                                            Location
                                            <i ng-if="vm.tableSort.reverse && vm.tableSort.id == 4" class="fa fa-chevron-up"></i>
                                            <i ng-if="!vm.tableSort.reverse && vm.tableSort.id == 4" class="fa fa-chevron-down"></i>
                                        </th>
                                    </tr>
                                    <tr ng-click="vm.getHistory(tr)" ng-repeat="tr in vm.currTable | orderBy:vm.tableSort.str">
                                        <td >{{tr.name}}</td>
                                        <td >{{tr.event}}</td>
                                        <td >{{tr.time | date : 'HH mm ss a'}}</td>
                                        <td >{{tr.location}}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </md-tab-body>
            </md-tab>
        </md-tabs>
    </md-content>
    </md-dialog-content>
</md-dialog>

<script>
    $(document).ready(function () {
        $('#start_time').datetimepicker({
            mask: '9999/19/39 29:59',
            format: 'Y-M-d H:i'
        });

        $('#end_time').datetimepicker({
            mask: '9999/19/39 29:59',
            format: 'Y-M-d H:i'
        });
    });
</script>
